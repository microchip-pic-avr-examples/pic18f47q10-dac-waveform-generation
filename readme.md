# Introduction  
The Digital-to-Analog Converter (DAC) converts a digital value to an analog voltage. The DAC module offers flexible input source selection, provision to route output to other peripherals such as analog comparator and Analog to Digital converter, and configurable registers set.

DAC has a flexible option to choose both positive as well as negative reference voltage sources, depending on application requirement.

This Xpress example discusses how DAC peripherals from PICQ10, can be used to generate reference voltage and different signals.


# Reference Voltage and Waveform Generation Using DAC
The signals generated in this example are “Sine wave, Triangular wave, Square wave, Sawtooth wave, and constant (reference) voltage signals”. The digital Look Up Table (LUT) is created and fed into DAC input to generate the corresponding signal.  

### The LUT is generated by considering following parameters-
1.  Constant (Reference) Voltage :
* 	 Voltage 1.6V
* 	 Voltage 3.196V

2.  Waveforms:
* 	Amplitude of the signal – 3.196V
* 	Frequency of the signal – 500Hz (The Example demonstrates signal frequency as constant parameter.  Firmware source code can be modified to change the frequency of signal.)

The following figure 1 shows an overview of the Signal Generator Example.

![](https://i.imgur.com/zFBYrdP.jpg)

**Figure 1: Application Block Diagram**

The Signal Generator example is implemented using Curiosity Nano board with PIC18F47Q10, and oscilloscope is used to monitor the generated signals. 												

The onboard push button (SW0) is used to switch between the Constant voltage and various waveforms.

This example generates the reference voltage 1 at power up, and the signal outputs will be changed after each switch press as per following sequence

1.	Reference voltage 1.6V (on Power up)
2.	Reference voltage 3.196V
3.	Sine Wave
4.	Triangle Wave
5.	Square Wave
6.	Sawtooth Wave

Operation of this example is discussed in following section.

# Software Tools
Following Microchip’s free IDE, compiler and graphical code generators are used for the application firmware development.

* MPLAB X IDE v5.30
* XC8 Compiler v2.10
* MCC Code Configurator v3.85.1

# Hardware Setup
The following figures (Figure 2.1 and Figure 2.2) shows the hardware connections/details.

![](https://i.imgur.com/b0nkWlG.jpg)

**Figure 2.1: Application Hardware Setup, Front View{**																		

![](https://i.imgur.com/0lNUV3p.jpg)

**Figure 2.2: Application Hardware Setup, Rear View**
# Peripheral configurations using MCC
## ->  System configuration

System configuration in MCC is used for Microcontroller oscillator configuration, PLL, Watchdog timer and low voltage programming settings. In this example internal oscillator of 4MHz frequency with clock divider 1 is used as a system clock and the Watchdog timer is disabled.

The following figure 3 shows the system configuration settings in MCC.

![](https://i.imgur.com/AJqnfon.png)

 **Figure 3: System Configuration using MCC**

## -> DAC configuration
The Digital to Analog Convertor module is used to convert digital Look Up Table into analog signal. DAC is configured as follows.  

* DAC Positive Reference      - VDD of Microcontroller
* DAC Negative Reference    - VSS of Microcontroller
* DAC Output                            - DAC1OUT1 pin of Microcontroller  
* DAC Output Pin                     - RA2

The following figure 4 shows the DAC configuration using MCC.

![](https://i.imgur.com/OorEoCx.png)

**Figure 4: DAC Configuration using MCC**

## 	-> Pin Mapping				
The I/O pin mapping of the PIC18F47Q10 MCU for DAC interface and Curiosity Nano on board LED is shown in the following figure 5.

![](https://i.imgur.com/7wXSO1A.png)

**Figure 5: Pin Module Settings in MCC**		

The on-board switch SW0 on the Curiosity Nano board is connected to PE2.  As external interrupt configuration is not possible on pin PE2, pin RC2 is configured as Interrupt on Change (IOC) and RC2 is shorted to RE2 using external jumper for detecting button press event using IOC feature.

# Operation

* 	Setup the hardware, as per Hardware Setup (Refer Figure 2.1 and 2.2).
* 	Connect the pins RE2 and RC2 using the jumper.
* 	Connect RA2 (DAC1OUT1 Pin) to the positive terminal of the Scope (DSO/Oscilloscope) and connect GND (CNANO board ground pin) to GND terminal of scope.  
* 	Power on the CNANO board by connecting the micro USB cable from micro USB socket (Micro USB Connector) on the CNANO board to the PC USB socket.
* 	The Curiosity Nano board should appear as a Mass Storage Device after connecting to the PC.
*  Click on **Make and program device**.

	![](https://i.imgur.com/N2eSOtH.png)

	**Figure 6: Programing the device**
*   IDE generates the .hex file, save the file in local PC.
*   Drag the .hex from the downloads section and drop the file on to the Curiosity drive. This should program the device.
* 	Turn on the Oscilloscope.
* 	Observe the default Constant Signal (Reference Voltage 1.6V) on the Oscilloscope screen.

![](https://i.imgur.com/62ykDJU.png)

**Figure 7: Generated Reference voltage (1.6V) Signal on Oscilloscope screen**

* 	Press on board button (SW0) to change the generated signal and observe the constant 3.196 volts signal on the Oscilloscope screen.

![](https://i.imgur.com/DvoCjDQ.png)

 **Figure 8: Generated Constant voltage (3.196V) Signal on Oscilloscope screen**

* 	Press on board button (SW0) to change the generated signal and observe the Sine wave on the Oscilloscope screen. 	

![](https://i.imgur.com/7ruiWPF.png)

**Figure 9: Generated Sine Wave on Oscilloscope screen**

* 	Press on board button (SW0) to change the generated signal and observe the Triangular wave on the Oscilloscope screen. 								

![](https://i.imgur.com/vskitV2.png)

**Figure 10: Generated Triangle Wave on Oscilloscope screen**

* 	Press on board button (SW0) to change the generated signal and observe the Square wave on the Oscilloscope screen.

![](https://i.imgur.com/ObnkreO.png)

**Figure 11: Generated Square Wave on Oscilloscope screen**

* 	Press on board button (SW0) to change the generated signal and observe the Saw tooth wave on the Oscilloscope screen. 						

![](https://i.imgur.com/ry0mitv.png)

**Figure 12: Generated Sawtooth Wave on Oscilloscope screen**

* 	Press on board button (SW0) to change the generated signal and observe the default signal Sine wave on the Oscilloscope screen.
* 	Cycle is repeated, once six signals are generated and displayed.
* 	The signal change happens for every button (SW0) press.  

# Conclusion
This example illustrates reference voltage generation and signal generator implementation using Digital to Analog Converter (DAC) peripheral of 8-Bit PIC MCU.

Configurations like Reference Voltage generation, Signal generation using DAC, DAC output as ADC input, DAC output as Non-inverting input to the Analog Comparator can be implemented using flexible 5-Bit DAC peripheral of the PIC MCU.
